{"version":3,"file":"roll.js","sources":["../../../src/vector/roll.ts"],"sourcesContent":["type RollOptions = {\n  partial?: boolean;\n  /** which direction the window is aligned to (default: right, looking back)\n   * - right: current row is the last item [1,2,**3**]\n   * - left: current row is the first item [**1**,2,3]\n   * - center: current row is the center item [1,**2**,3]\n   */\n  align?: 'left' | 'center' | 'right';\n};\n\n/**\n * Returns a function that computes the a rolling value (e.g. moving average) by\n * applying a function over a window of data\n * @param width The size of the window\n * @param rollFn The function to apply to the window (should reduce to a single value)\n * @param options Options to configure roll. e.g. whether to run on partial windows.\n */\nexport function roll<T extends object>(\n  width: number,\n  rollFn: (itemsInWindow: T[], endIndex: number) => any,\n  options?: RollOptions | undefined | null\n) {\n  const { partial = false, align = 'right' } = options ?? {};\n\n  const halfWidth = Math.floor(width / 2);\n\n  return (items: any[]) => {\n    return items.map((_, i) => {\n      const endIndex =\n        align === 'right'\n          ? i\n          : align === 'center'\n          ? i + halfWidth\n          : i + width - 1;\n\n      // partial window and we don't allow partial computation, return undefined\n      if (!partial && (endIndex - width + 1 < 0 || endIndex >= items.length)) {\n        return undefined;\n      }\n\n      const startIndex = Math.max(0, endIndex - width + 1);\n      const itemsInWindow = items.slice(startIndex, endIndex + 1);\n\n      // reduce them to a single value\n      return rollFn(itemsInWindow, endIndex);\n    });\n  };\n}\n"],"names":[],"mappings":";;;;cAkBE,OACA,QACA;AAEA,QAAM,CAAE,UAAU,OAAO,QAAQ,WAAY,4BAAW;AAExD,QAAM,YAAY,KAAK,MAAM,QAAQ;AAErC,SAAO,CAAC;AACN,WAAO,MAAM,IAAI,CAAC,GAAG;AACnB,YAAM,WACJ,UAAU,UACN,IACA,UAAU,WACV,IAAI,YACJ,IAAI,QAAQ;AAGlB,UAAI,CAAC,uBAAuB,QAAQ,IAAI,KAAK,YAAY,MAAM;AAC7D,eAAO;AAAA;AAGT,YAAM,aAAa,KAAK,IAAI,GAAG,WAAW,QAAQ;AAClD,YAAM,gBAAgB,MAAM,MAAM,YAAY,WAAW;AAGzD,aAAO,OAAO,eAAe;AAAA;AAAA;AAAA;;;;"}